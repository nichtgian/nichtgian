name: Deploy to GitHub Pages

on:
    push:
        branches:
            - main
    workflow_dispatch:

env:
    DENO_VERSION: v2.x
    BUILD_PATH: build
    BASE_PATH: '' # Set base path when no custom domain is used -> '/${{ github.event.repository.name }}'

permissions:
    contents: write

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        concurrency: ci-${{ github.ref }}

        steps:
            - name: '[ğŸ“] Checkout repository'
              uses: actions/checkout@v4

            - name: '[ğŸ”§] Install Deno'
              uses: denoland/setup-deno@v2
              with:
                  deno-version: ${{ env.DENO_VERSION }}

            - name: '[ğŸ”§] Install dependencies'
              run: deno install

            - name: '[ğŸ“] Formatting'
              run: deno fmt --check

            - name: '[ğŸ”] Linting'
              run: deno lint

            - name: '[ğŸ§ª] Build step'
              run: deno task build

            - name: '[ğŸš€] Deploy'
              uses: JamesIves/github-pages-deploy-action@v4
              with:
                  folder: ${{ env.BUILD_PATH }}
